{"version":3,"file":"Login-BR_Q1MeE.js","sources":["../../src/pages/Login.vue"],"sourcesContent":["<template>\r\n    <div class=\"login\">\r\n        <h1 v-html=\"t('pages.login.title')\"></h1>\r\n\r\n        <div class=\"description\">\r\n            <p>{{ t('pages.login.description.intro') }}</p>\r\n            <ul>\r\n                <li v-for=\"(item, id) in data.steps\" :key=\"id\" v-html=\"item\"></li>\r\n            </ul>\r\n            <div class=\"code\">{{ user.externalCode }}</div>\r\n        </div>\r\n\r\n        <div class=\"footer\">\r\n            <div class=\"terms\">\r\n                <span>\r\n                    {{ t('pages.login.terms') }}\r\n                    <a href=\"https://github.com/Bilbo-Music/bilbo-docs-public/blob/main/terms%20of%20service/Bilbo%20Studio.md\" target=\"_blank\">{{ t('pages.login.terms-button') }}</a>\r\n                    {{ t('pages.login.terms-2') }}\r\n                </span>\r\n            </div>\r\n            <Select\r\n                class=\"noerror inline icon-only\"\r\n                :optionList=\"locale.languages\"\r\n                :value=\"locale.locale\"\r\n                :clearable=\"false\"\r\n                :leftAuto=\"!locale.rtl\"\r\n                :rightAuto=\"locale.rtl\"\r\n                @change=\"onLanguageChange\"\r\n            />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, watch, onMounted, onBeforeUnmount } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport Button from '🔗/components/ui/Button.vue';\r\nimport Select from '🔗/components/ui/Select.vue';\r\nimport stores from '@/stores';\r\n\r\nconst user = stores.user();\r\nconst nav = stores.nav();\r\nconst locale = stores.locale();\r\n\r\nconst { t, tm, rt } = useI18n();\r\n\r\nconst data = reactive({\r\n    steps: []\r\n});\r\n\r\nconst getSteps = () => {\r\n    data.steps = Array.isArray(tm('pages.login.description.steps')) ? tm('pages.login.description.steps').map(item => rt(item)\r\n    ) : [];\r\n}\r\n\r\nconst onLanguageChange = (payload) => {\r\n    locale.updateLocale(payload.value);\r\n};\r\n\r\nconst updateCode = async () => {\r\n    await user.createExternalLogin();\r\n\r\n    clearTimeout(data.updateCodeTimeout);\r\n    data.updateCodeTimeout = setTimeout(() => {\r\n        updateCode();\r\n    }, 5 * 60 * 1000); // Каждые 5 минут надо актуализировать токен\r\n\r\n    setTimeout(() => {\r\n        checkCode();\r\n    }, 5 * 1000);\r\n}\r\n\r\nconst checkCode = async () => {\r\n    const result = await user.checkExternalLogin();\r\n\r\n    if (!result) {\r\n        clearTimeout(data.checkCodeTimeout);\r\n        data.checkCodeTimeout = setTimeout(() => {\r\n            checkCode();\r\n        }, 4 * 1000); // Каждые 4 секунды надо запрашивать статус\r\n        return;\r\n    }\r\n\r\n    await user.getArtists();\r\n\r\n    nav.open('/');\r\n}\r\n\r\n\r\nwatch(() => locale.locale, () => {\r\n    getSteps();\r\n});\r\n\r\nonMounted(() => {\r\n    getSteps();\r\n    updateCode();\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n    clearTimeout(data.checkCodeTimeout);\r\n    delete data.checkCodeTimeout;\r\n\r\n    clearTimeout(data.updateCodeTimeout);\r\n    delete data.updateCodeTimeout;\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .login {\r\n        width: 36vw;\r\n        padding: 72px 24px 24px;\r\n        backdrop-filter: blur(10px) brightness(0.7);\r\n        position: fixed;\r\n        left: 0;\r\n        top: 0;\r\n        bottom: 0;\r\n        display: flex;\r\n        flex-direction: column;\r\n        min-width: 380px;\r\n\r\n        h1 {\r\n            margin: 0;\r\n            font: var(--font-h3);\r\n            font-weight: bold;   \r\n            color: var(--white-500);\r\n        }\r\n\r\n        .description {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 16px;\r\n            margin: auto 0;\r\n            p {\r\n                margin: 0;\r\n                padding: 0;\r\n                font: var(--font-body-1);\r\n                color: var(--primary-100);\r\n                b {\r\n                    color: var(--white-500);\r\n                }\r\n            }\r\n            ul {\r\n                display: flex;\r\n                flex-direction: column;\r\n                gap: 16px;\r\n                list-style: none;\r\n                margin: 0;\r\n                padding: 0;\r\n                li {\r\n                    font: var(--font-body-2);\r\n                    color: var(--white-500);\r\n                }\r\n            }\r\n            .code {\r\n                font: var(--font-h2);\r\n                color: var(--white-500);\r\n            }\r\n        }\r\n\r\n        .footer {\r\n            margin-top: auto;\r\n            display: flex;\r\n            flex-direction: row;\r\n            align-items: center;\r\n            gap: 16px;\r\n            justify-content: space-between;\r\n\r\n            .terms {\r\n                display: inline;\r\n                span {\r\n                    font: var(--font-caption);\r\n                    color: var(--white-500);\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    gap: 0;\r\n                    align-items: start;\r\n                    a {\r\n                        font: var(--font-caption);\r\n                        color: var(--primary-500);\r\n                        transition: all .4s;\r\n                        &:hover {\r\n                            color: var(--primary-400);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    .direction-rtl .login {\r\n        left: auto;\r\n        right: 0;\r\n        .footer {\r\n\r\n        }\r\n    }\r\n</style>\r\n"],"names":["_openBlock","_createElementBlock","_createElementVNode","_unref","_Fragment","_toDisplayString","_createTextVNode","_createVNode","Select"],"mappings":"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"}